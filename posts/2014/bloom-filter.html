<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Bloom Filter</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Bloom Filter"/>
            <meta property="og:url" content="http://www.raydevblog.us/posts/2014/bloom-filter.html"/>
            <meta property="og:description" content="I've never used Bloom filters in practice, but I often heard about them. All I intended to do here is study general ideas and applications about Bloom filter. Bloom filter is a space-efficient probabilistic data structure used to test set membership. It tells us that the element either definitely ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://www.raydevblog.us/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://www.raydevblog.us/theme/css/bootstrap-glyphicons.css" rel="stylesheet">
    <link href="http://www.raydevblog.us/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

        <link href="http://www.raydevblog.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Ray's Thoughts and Writings ATOM Feed"/>

    <!-- Latex -->
        
    <script type= "text/javascript">
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = 'https:' == document.location.protocol ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js' : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; 
        s[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" + 
            "    config: ['MMLorHTML.js']," + 
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS','output/NativeMML']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," + 
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax .mo, .MathJax .mi': {color: 'black ! important'}} " +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(s);
    </script>

  

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.raydevblog.us" class="navbar-brand">Ray's Thoughts and Writings</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="http://www.raydevblog.us/category/data-structure-and-algorithm.html">Data Structure and Algorithm</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/java.html">Java</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/machine-learning.html">Machine Learning</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/miscellaneous.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/python.html">Python</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/system-design.html">System Design</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://www.raydevblog.us/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://www.raydevblog.us/posts/2014/bloom-filter.html"
                       rel="bookmark"
                       title="Permalink to Bloom Filter">
                        Bloom Filter
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Mon 28 July 2014
    </span>



<span class="label label-default">Tags</span>
	<a href="http://www.raydevblog.us/tag/data-structure.html">data structure</a>
        /
	<a href="http://www.raydevblog.us/tag/bloom-filter.html">bloom filter</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>I've never used Bloom filters in practice, but I often heard about them. All I intended to do here is study general ideas and applications about Bloom filter.</p>
<p>Bloom filter is a space-efficient <strong>probabilistic</strong> data structure used to test set membership. It tells us that the element either <em>definitely</em> is not in the set or <em>may be</em> in the set. In other words, <strong>false positives</strong> are possible, however <strong>false negatives</strong> are not.</p>
<h3>Data Structure</h3>
<p>Bloom filter is not a key-value store. The base data structure of a bloom filter is a <strong>Bit Vector</strong>, a vector of bit buckets indicating the presence of an element in the filter. </p>
<p>To add an element, we simply hash it a few times and set the bits in the bit vector at the bucket index of those hashes to 1. To test for membership, we simply hash the element with the same hash functions, then see if those values are set in the bit vector. If they aren't, we know that the element isn't in the set. If they are, we only know that it <em>might be</em>, because some combination of other elements could have set the same bits. Removing an element from the filter is not possible. The more elements that are added to the set, the larger the probability of false positives. The website <a href="http://billmill.org/bloomfilter-tutorial">Bloom Filters by Example</a> shows you how to add and test strings in the bloom filter.</p>
<p><img alt="Alt text" src="http://www.raydevblog.us/images/bloom_filter.jpg" /></p>
<h3>Hash Functions</h3>
<p>The hash functions used in a bloom filter should be independent, uniformly distributed and as fast as possible. Examples of fast, simple hashes include <a href="https://code.google.com/p/smhasher">MurmurHash</a>, the fnv series of hashes, and Jenkins Hashes. Cryptographic hashes such as sha1 and MD5 are not very good choices.</p>
<p>Let's assume a bloom filter with k hashes, m bits in the filter, and n elements to be inserted. <a href="http://en.wikipedia.org/wiki/Bloom_filter#Probability_of_false_positives">Wikipedia</a> provides the math for choosing these values. </p>
<p>The false positive rate of our filter will be approximately:</p>
<p>\begin{equation} fpr = (1 - e^{-kn/m})^k \end{equation}</p>
<p>The more hash functions we have, the slower our bloom filter, and the quicker it fills up. If we have too few, we may suffer too many false positives. Given an m and an n, we have a function to choose the optimal value of k:</p>
<p>\begin{equation} k_{opt} = \frac{m}{n}\ln 2 \approx 0.7\frac{m}{n} \end{equation}</p>
<p>This results in:</p>
<p>\begin{equation} m = -\frac{n\ln fpr}{(\ln 2)^2} \end{equation}</p>
<p>This means that for a given false positive probability fpr, the length of a Bloom filter m is proportionate to the the number of elements being filtered n. A bloom filter with an optimal value for k and 1% error rate only needs 9.6 bits per key. Add 4.8 bits/key and the error rate decreases by 10 times.</p>
<h3>Extensions</h3>
<p>Removing elments from the filter can be addressed with a <strong>counting</strong> bloom filter. A counting filter uses an n-bit counter instead of a single bit in each bucket. The insert operation increments the value of the buckets, and the delete operation decrements the value of the buckets. The n-bit counters must be large enough to avoid overflow.</p>
<p><a href="http://gsd.di.uminho.pt/members/cbm/ps/dbloom.pdf">Almeida et al.</a> proposed a variant of Bloom filters that can adapt dynamically to the number of elements stored, while assuring a minimum false positive probability. If we can not estimate the number of elements to be inserted, we maybe better off with a scalable Bloom filter. </p>
<h3>Applications and Implementations</h3>
<ul>
<li>
<p>Bloom filters are present in a lot of NoSQL systems. Take <a href="http://wiki.apache.org/cassandra/ArchitectureOverview">Cassandra</a> for example, Bloom filter provides a lightweight in-memory structure to reduce the number of I/O reads when performing a key loopup. Each SSTable has a bloom filter associated with it. Cassandra checks before doing any disk seeks, skipping queries for keys that don't exist. </p>
</li>
<li>
<p>The URL shortening service company Bitly, Inc. open sourced a scalable, counting bloom filter library <strong><a href="https://github.com/bitly/dablooms">dablooms</a></strong>. You can read <a href="http://word.bitly.com/post/28558800777/dablooms-an-open-source-scalable-counting-bloom">bitly's engineering blog post</a> for implemetation details.</p>
</li>
<li>
<p>I also found an interesting <a href="http://www.quora.com/Bloom-Filters/What-are-the-best-applications-of-Bloom-filters">discussion</a> on Quora about the best applications of Bloom filters.</p>
</li>
<li>
<p>This blog <a href="http://maxburstein.com/blog/creating-a-simple-bloom-filter/">post</a> shows how to create a simple bloom filter using Python. We also have a Python implementation <strong><a href="https://github.com/jaybaird/python-bloomfilter">PyBloom</a></strong>. </p>
</li>
</ul>
<h3>References</h3>
<ul>
<li><a href="http://billmill.org/bloomfilter-tutorial">Bloom Filters by Example</a></li>
<li><a href="http://www.slideshare.net/quipo/modern-algorithms-and-data-structures-1-bloom-filters-merkle-trees">Modern Algorithms and Data Structures - Bloom Filters</a></li>
</ul>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname
            var disqus_identifier = 'bloom-filter';
            var disqus_url = 'http://www.raydevblog.us/posts/2014/bloom-filter.html';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="http://www.linkedin.com/in/leichen1983"><i
                            class="icon-linkedin-sign icon-large"></i>linkedin
                    </a></li>
                    <li class="list-group-item"><a href="https://twitter.com/garudareiga"><i
                            class="icon-twitter-sign icon-large"></i>twitter
                    </a></li>
                    <li class="list-group-item"><a href="https://github.com/garudareiga"><i
                            class="icon-github-sign icon-large"></i>github
                    </a></li>
                    <li class="list-group-item"><a href="http://www.raydevblog.us/feeds/all.atom.xml"><i
                            class="icon-rss-sign icon-large"></i>rss
                    </a></li>



            <li class="list-group-item"><a href="http://www.raydevblog.us/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item tag-1">
                    <a href="http://www.raydevblog.us/tag/concurrency.html">
                        concurrency
                    </a>
                </li>
                <li class="list-group-item tag-1">
                    <a href="http://www.raydevblog.us/tag/key-value-store.html">
                        key-value store
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://www.raydevblog.us/tag/java.html">
                        java
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://www.raydevblog.us/tag/python.html">
                        python
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/mongodb.html">
                        mongodb
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/logging.html">
                        logging
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/data-structure.html">
                        data structure
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/machine-learning.html">
                        machine learning
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/data-mining.html">
                        data mining
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/json.html">
                        json
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/bloom-filter.html">
                        bloom filter
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/two-phase-commit.html">
                        two-phase commit
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/consistent-hashing.html">
                        consistent hashing
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/distributed.html">
                        distributed
                    </a>
                </li>
        </ul>
    </section>
</aside>        </div>
    </div>
</div>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.raydevblog.us/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.raydevblog.us/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
</body>
</html>