<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <title>Dynamo: Amazon's Highly Available Key-Value Store</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Open Graph tags -->

            <meta property="og:type" content="article"/>
            <meta property="og:title" content="Dynamo: Amazon's Highly Available Key-Value Store"/>
            <meta property="og:url" content="http://www.raydevblog.us/posts/2014/dynamo-amazons-highly-available-key-value-store.html"/>
            <meta property="og:description" content="This paper was first released in SOSP'07, describes Dynamo, the underlying storage technology for several core services in Amazon's e-commerce platform. Since then, Several Dynamo-inspired databases have appeared (either entirely or partially) by this paper, such as Riak, Cassandra and Voldemort. Hence, I decide to read this paper ..."/>

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://www.raydevblog.us/theme/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://www.raydevblog.us/theme/css/bootstrap-glyphicons.css" rel="stylesheet">
    <link href="http://www.raydevblog.us/theme/css/pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/style.css" type="text/css"/>
    <!-- JavaScript plugins (requires jQuery) -->
    <script src="http://code.jquery.com/jquery.js"></script>

        <link href="http://www.raydevblog.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Ray's Thoughts and Writings ATOM Feed"/>

    <!-- Latex -->
        
    <script type= "text/javascript">
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.src = 'https:' == document.location.protocol ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js' : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'; 
        s[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" + 
            "    config: ['MMLorHTML.js']," + 
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS','output/NativeMML']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," + 
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax .mo, .MathJax .mi': {color: 'black ! important'}} " +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(s);
    </script>

  

</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.raydevblog.us" class="navbar-brand">Ray's Thoughts and Writings</a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://www.raydevblog.us/category/data-structure-and-algorithm.html">Data Structure and Algorithm</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/java.html">Java</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/machine-learning.html">Machine Learning</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/miscellaneous.html">Miscellaneous</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/python.html">Python</a>
                        </li>
                        <li class="active">
                            <a href="http://www.raydevblog.us/category/system-design.html">System Design</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://www.raydevblog.us/archives.html"><i class="icon-th-list"></i>Archives</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</nav>
<!-- /.navbar -->
<div class="container">
    <div class="row">
        <div class="col-lg-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://www.raydevblog.us/posts/2014/dynamo-amazons-highly-available-key-value-store.html"
                       rel="bookmark"
                       title="Permalink to Dynamo: Amazon's Highly Available Key-Value Store">
                        Dynamo: Amazon's Highly Available Key-Value Store
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="icon-calendar"></i>Sun 20 July 2014
    </span>



<span class="label label-default">Tags</span>
	<a href="http://www.raydevblog.us/tag/key-value-store.html">key-value store</a>
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This <a href="http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html">paper</a> was first released in SOSP'07, describes Dynamo, the underlying storage technology for several core services in Amazon's e-commerce platform. Since then, Several Dynamo-inspired databases have appeared (either entirely or partially) by this paper, such as Riak, Cassandra and Voldemort. Hence, I decide to read this paper and briefly describe some well-know technologies implemented by Dynamo.</p>
<h3>Introduction</h3>
<p>Dynamo is a completely decentralized system targeting applications that operate with weaker consistency and high availability. It is built to be an <strong>"always writeable"</strong> data store. Hence, Dynamos allows conflicting updates in the system. </p>
<p>Dynamo achieves scalability and availability by the following technologies:</p>
<ul>
<li>Data is partitioned and replicated using consistent hashing.</li>
<li>Consistency is facilitated by object versioning. </li>
<li>The consistency among replicas during updates is maintained by a quorum-like technique and a decentralized replica synchronization protocol. </li>
<li>A gossip based distributed failure detection and membership protocol. </li>
</ul>
<h3>System Architecture</h3>
<p>Table 1 presents a summary of the list of techniques Dynamo uses and their respective advantages.
<img alt="Alt text" src="http://www.raydevblog.us/images/dynamo.jpeg" /></p>
<p>The paper gives details on the partitioning, replication, versioning, membership, and failure handling components of Dynamo.</p>
<h3>Partitioning</h3>
<h4>Consistent Hashing</h4>
<p>Dynamo's partitioning scheme relies on a variant of consistent hashing for load balancing. It applies a MD5 hash on the key to generate a 128-bit identifier, which is used to determine the storage nodes. The hash output range forms a ring, and each node in the system is assigned a position on the ring. Thus, each node is responsible for the region in the ring between it and its predecessor node. To know the detail about consistent hashing, please refer to this blog <a href="http://www.tomkleinpeter.com/2008/03/17/programmers-toolbox-part-3-consistent-hashing">post</a>.</p>
<h4>Virtual Node</h4>
<p>Dynamo uses the concept of "virtual nodes", and each physical node can be responsible for more than one virtual node on the ring. Using virtual nodes makes the key distribution load balancing more fine-grained and more uniform:</p>
<ul>
<li>The load handled by an unavailable node is evenly dispersed across the remaining available nodes.</li>
<li>A new node accepts a roughly equivalent of load from each of the other available nodes.</li>
<li>The number of virtual nodes that a physical node is responsible can be decided by its capacity.</li>
</ul>
<h4>Replication</h4>
<p>To achieve high availability, each data is replicated at N storage hosts. Each key is assigned to a coordinator node. The coordinator stores each key locally and replicates at the N-1 clockwise successor nodes in the ring. The list of nodes responsible for storing a particular key is called the <strong>preference list</strong>.</p>
<h3>Object Versioning</h3>
<p>Dynamo provides <a href="http://en.wikipedia.org/wiki/Eventual_consistency">eventual consistency</a>, which allows for updates on replicas <strong>asynchronously</strong>. Dynamo treats the result of every modification as a new and immutable version of data. It uses <strong>vector clocks</strong> to capture causality between different versions of the same object. One verctor clock is associated with every version of every object. Upon processing a read request, Dynamo detects conflicts and employs application-assisted conflict resolution if necessary. </p>
<h3>Sloppy Quorum</h3>
<p>Dynamo uses a "sloppy quoram" instead of strict quorum. All read and write operations are performed on the first N healthy nodes in the preference list, skipping those that are down or inaccessible. To maintain consistency among its replicas, Dynamo uses a consistency protocol similar to quorum-based voting. This protocol has two key configurable values: R and W. R is the minimum number of nodes that must participate in a successful read operation. W is the minimum number of nodes that must participate in a successful write operation. Setting R and W such that R + W &gt; N yields a quorum-like system. </p>
<h3>Merkle Tree</h3>
<p>A <a href="http://en.wikipedia.org/wiki/Merkle_tree">Merke tree</a> is a hash tree where leaves are hashes of the values of individual keys. Parent nodes higher in the tree are hashes of their respective children. If the hash values of the root of two trees are equal, then the values of the leaf nodes in the tree are equal and the nodes require no synchronization. If not, it implies that the values of some replicas are different. </p>
<p>Dynamo uses Merkle Trees for anti-entropy to keey the replicas synchronized. Each virtual node maintains a seperate Merkle tree for each key range it hosts. This allows nodes to compare whether the keys within a key range are up-to-date.</p>
<h3>Gossip-based Membership and Failure Detection</h3>
<p>Decentralized failure detection protocols use a simple gossip-style protocol that enable each node in the system to learn about the arrival or departure of other nodes.</p>
<h3>Reference</h3>
<ul>
<li><a href="http://muratbuffalo.blogspot.com/2010/11/dynamo-amazons-highly-available-key.html">Dynamo: Amazon's highly available key-value store</a></li>
<li><a href="http://jsensarma.com/blog/?p=55">Dynamo: A flawed architecture</a></li>
<li><a href="http://docs.basho.com/riak/1.3.2/references/dynamo/">Riak docs</a></li>
</ul>
            </div>
            <!-- /.entry-content -->
    <hr />
    <section class="comments" id="comments">
        <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname
            var disqus_identifier = 'dynamo-amazons-highly-available-key-value-store';
            var disqus_url = 'http://www.raydevblog.us/posts/2014/dynamo-amazons-highly-available-key-value-store.html';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-lg-3 well well-sm" id="sidebar">
<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="icon-home icon-large"></i>Social</h4></li>
                    <li class="list-group-item"><a href="http://www.linkedin.com/in/leichen1983"><i
                            class="icon-linkedin-sign icon-large"></i>linkedin
                    </a></li>
                    <li class="list-group-item"><a href="https://twitter.com/garudareiga"><i
                            class="icon-twitter-sign icon-large"></i>twitter
                    </a></li>
                    <li class="list-group-item"><a href="https://github.com/garudareiga"><i
                            class="icon-github-sign icon-large"></i>github
                    </a></li>
                    <li class="list-group-item"><a href="http://www.raydevblog.us/feeds/all.atom.xml"><i
                            class="icon-rss-sign icon-large"></i>rss
                    </a></li>



            <li class="list-group-item"><a href="http://www.raydevblog.us/tags.html"><h4><i class="icon-tags icon-large"></i>Tags</h4></a></li>
                <li class="list-group-item tag-1">
                    <a href="http://www.raydevblog.us/tag/concurrency.html">
                        concurrency
                    </a>
                </li>
                <li class="list-group-item tag-1">
                    <a href="http://www.raydevblog.us/tag/key-value-store.html">
                        key-value store
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://www.raydevblog.us/tag/java.html">
                        java
                    </a>
                </li>
                <li class="list-group-item tag-2">
                    <a href="http://www.raydevblog.us/tag/python.html">
                        python
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/mongodb.html">
                        mongodb
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/data-mining.html">
                        data mining
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/json.html">
                        json
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/machine-learning.html">
                        machine learning
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/distributed.html">
                        distributed
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/two-phase-commit.html">
                        two-phase commit
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/consistent-hashing.html">
                        consistent hashing
                    </a>
                </li>
                <li class="list-group-item tag-4">
                    <a href="http://www.raydevblog.us/tag/logging.html">
                        logging
                    </a>
                </li>
        </ul>
    </section>
</aside>        </div>
    </div>
</div>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.raydevblog.us/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.raydevblog.us/theme/js/respond.min.js"></script>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
</body>
</html>