<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Creational Patterns in Java - Ray's Thoughts and Writings</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://www.raydevblog.us/posts/2014/creational-patterns-in-java.html">

        <meta name="author" content="Ray Chen" />
        <meta name="description" content="Singleton Design Pattern Singleton design pattern restricts the instantiation of a class and ensures that only one instance of the class exists in the JVM. It is used for logging, caching and thread pool. Eager Initialization Using eager initialization, we rely on the JVM to create the unique Singleton instance ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://www.raydevblog.us/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://www.raydevblog.us/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/style.css" type="text/css"/>

        <link href="http://www.raydevblog.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Ray's Thoughts and Writings ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.raydevblog.us/" class="navbar-brand">
Ray's Thoughts and Writings            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://www.raydevblog.us/category/algorithm.html">Algorithm</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/data.html">Data</a>
                        </li>
                        <li class="active">
                            <a href="http://www.raydevblog.us/category/java.html">Java</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/python.html">Python</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/system.html">System</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://www.raydevblog.us/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://www.raydevblog.us/posts/2014/creational-patterns-in-java.html"
                       rel="bookmark"
                       title="Permalink to Creational Patterns in Java">
                        Creational Patterns in Java
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-11-09T10:30:00"> Sun 09 November 2014</time>
    </span>



    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h3>Singleton Design Pattern</h3>
<p>Singleton design pattern restricts the instantiation of a class and ensures that only one instance of the class exists in the JVM. It is used for logging, caching and thread pool.</p>
<h4>Eager Initialization</h4>
<p>Using eager initialization, we rely on the JVM to create the unique Singleton instance when the class is loaded. The JVM guarantees that the instance will be created before any thread accesses the static uniqueInstance variable.
If a singleton is expected to carry state, then those state variables should have synchronized access to make them thread safe.</p>
<div class="gist">
    <script src='https://gist.github.com/198c94bae70cb36cf5fe.js?file=singleton-pattern.java'></script>
    <noscript>
        <pre><code>public class Singleton {
    private static Singleton instance = new Singleton();
    private Map<String, String> kvmap = new ConcurrentHashMap(new HashMap<String, String>());

    private Singleton() {}

    public static Singleton getInstance { return instance; }

    public String getValue(String key) { return kvmap.get(key); }
    public Set<String> getKeys() { return kvmap.keySet(); }
}</code></pre>
    </noscript>
</div>
<h4>Lazy Initialization</h4>
<p>Use "double-checked locking" to reduce the use of synchronization in <strong>getInstance()</strong>. The volatile keyword ensures that multiple threads handle the uniqueInstance variable correctly when it is being initialized to the Singleton instance.</p>
<div class="gist">
    <script src='https://gist.github.com/198c94bae70cb36cf5fe.js?file=singleton-lazy-initialization.java'></script>
    <noscript>
        <pre><code>public class Singleton {
    private volatile static Singleton uniqueInstance;

    private Singleton() {}

    public static Singleton getInstance() {
        if (uniqueInstance == null) {
            synchronized (Singleton.class) {
                if (uniqueInstance == null) {
                    uniqueInstance = new Singleton();
                }
            }
        }
        return uniqueInstance;
    }
}</code></pre>
    </noscript>
</div>
<h4>Bill Pugh Approach</h4>
<p>The Bill pugh approach suggests to use static inner class. Until we need an instance, the SingletonHolder class will not be initialized until required. </p>
<div class="gist">
    <script src='https://gist.github.com/198c94bae70cb36cf5fe.js?file=singleton-bill-pugh.java'></script>
    <noscript>
        <pre><code>public class Singleton {
    private Singleton() {}

    private static class SingletonHolder {
        private static final Singleton instance = new Singleton();
    }

    public static Singleton getInstance() {
        return SingletonHolder.instance;
    }
}</code></pre>
    </noscript>
</div>
<h4>Unit Test</h4>
<p>Singletons are hard to mock in unit tests due to their private constructors. We should always have singletons implement an interface which allows for mock instances in unit tests. As follows, we can use <strong>Dependency Injection</strong> to make the <strong>Client</strong> class to receive the <strong>Server</strong> singleton instance in its constructor, instead of using the static <strong>getInstance</strong> method.</p>
<div class="gist">
    <script src='https://gist.github.com/198c94bae70cb36cf5fe.js?file=singleton-server-interface.java'></script>
    <noscript>
        <pre><code>public interface ServerInterface {
    public void config(String[] params);
}

public class ServerSingleton implements ServerInterface {
    private ServerSingleton() {}

    private static class SingletonHolder {
        private static final ServerSingleton uniqueInstance = new ServerSingleton();
    }

    public static ServerSingleton getInstance() {
        return SingletonHolder.uniqueInstance;
    }

    public void config(String[] params) {
        // ...
    }
}

public class Client {
    private final ServerInterface server;
    
    public Client(ServerInterface server) {
        this.server = server;
    }
    
    public void configServer(String[] params) {
        this.server.config(params);
    }
}</code></pre>
    </noscript>
</div>
<h3>Factory Design Pattern</h3>
<h4>Factory Pattern</h4>
<p><strong>Factory pattern</strong> is used to create instances of different classes of same type, based on different parameters. It helps encapsulate object creation. The example below is about creating <strong>Pizza</strong> in a factory:</p>
<ul>
<li>Pizza: product of the factory</li>
<li>CheesePizza/VeggiePizza: concrete products that implement the Pizza interface</li>
<li>PizzaFactory: factory where create concrete products</li>
<li>PizzaStore: client of the factory</li>
</ul>
<p>In design patterns, the phrase "implement an interface" does NOT always mean "write a class that implements a Java interface, by using the <strong>implements</strong> keyword in the class declaration." In the general use of the phrase, a concrete class implementing a method from a <strong>supertype</strong> (which could be a class OR interface) is still considered to be "implementing the interface" of that supertype.</p>
<div class="gist">
    <script src='https://gist.github.com/4bc01df870e1c1b87843.js?file=factory-pattern.java'></script>
    <noscript>
        <pre><code>public abstract class Pizza {
    String name;
    
    public String getName() { return name; }
    public void prepare() { System.out.println("Preparing " + name); }
    public void bake() { System.out.println("Baking " + name); }
}
 
public class CheesePizza extends Pizza {
    public CheesePizza() { name = "CheesePizza"; }
}
 
public class VeggiePizza extends Pizza {
    public VeggiePizza() { name = "VeggiePizza"; }
}
 
public class PizzaFactory {
    public Pizza createPizza(String type) {
        Pizza pizza = null;
        if (type.equalsIgnoreCase("cheese")) {
            pizza = new CheesePizza();
        } else if (type.equalsIgnoreCase("veggie")) {
            pizza = new VeggiePizza();
        }
        return pizza;
    }
}

// Factory client code
public class PizzaStore {
    PizzaFactory factory;
    
    public PizzaStore(PizzaFactory factory) {
        this.factory = factory;
    }
    
    public Pizza orderPizza(String type) {
        Pizza pizza = factory.createPizza(type);
        pizza.prepare();
        pizza.bake();
        return pizza;
    }
}</code></pre>
    </noscript>
</div>
<h4>Factory Method Pattern</h4>
<p><strong>The Factory Method Pattern</strong> defines an interface for creating an object, but lets subclasses decide which class to instantiate. Factory Method lets a class defer instantiation to subclasses. This decouples the client code in the superclass from the object creation code in the subclass.</p>
<div class="highlight"><pre><span class="kd">abstract</span> <span class="n">Product</span> <span class="nf">factoryMethod</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">)</span>
</pre></div>


<p>The example below is about creating Pizza using a factory method:</p>
<div class="gist">
    <script src='https://gist.github.com/4bc01df870e1c1b87843.js?file=factory-method-pattern.java'></script>
    <noscript>
        <pre><code>//The Product classes
public abstract class Pizza {
    String name;
    
    public String getName() { return name; }
    public void prepare() { System.out.println("Preparing " + name); }
    public void bake() { System.out.println("Baking " + name); }
}

public class NYStyleCheesePizza extends Pizza {
    public NYStyleCheesePizza() {
        name = "NY Style Cheese Pizza";
    }
}

public class NYStyleVeggiePizza extends Pizza {
    public NYStyleVeggiePizza() {
        name = "NY Style Veggie Pizza";
    }
}

//The Creator classes
public abstract class PizzaStore {
    public Pizza orderPizza(String type) {
        Pizza pizza = createPizza(type);
        pizza.prepare();
        pizza.bake();
        return pizza;
    }

    // A factory method handles object creation and encapsulates it in a subclass
    protected abstract Pizza createPizza(String type);
}

public class NYPizzaStore extends PizzaStore {
    Pizza createPizza(String type) {
        Pizza pizza = null;
        if (type.equalsIgnoreCase("cheese")) {
            pizza = new NYStyleCheesePizza();
        } else if (type.equalsIgnoreCase("veggie")) {
            pizza = new NYStyleVeggiePizza();
        }
        return pizza;
    }
}</code></pre>
    </noscript>
</div>
<h3>Abstract Factory Pattern</h3>
<p>The abstract factory pattern provides an interface for creating families of related or dependent objects without specifying their concrete classes.</p>
<p>The example below is about creating Pizza using abstrace factory pattern:</p>
<ul>
<li>PizzaIngredientFactory: defines the interface that all concrete factories must implement.</li>
<li>NYPizzaIngredientFactory: concrete pizza factory making pizza ingredients.</li>
<li>NYPizzaStore: client which composed at runtime with an actual factory.</li>
<li>Dough/Cheese/Pepperoni: product family. Each concrete factory can produce a different set of products.</li>
</ul>
<div class="gist">
    <script src='https://gist.github.com/4bc01df870e1c1b87843.js?file=abstract-factory-pattern.java'></script>
    <noscript>
        <pre><code>// ingredients: dough, sauce
public interface Dough {};
public interface Cheese {};
public interface Pepperoni {};

public class ThinCrustDough implements Dough {
    public String toString() { return "This Crust Dough"; }
}

public class ParmesanCheese implements Cheese {
    public String toString() { return "Shredded Parmesan"; }
}

public class SlicedPepperoni implements Pepperoni {
    public String toString() { return "Sliced Pepperoni"; }
}

// abstract ingredient factory
public interface PizzaIngredientFactory {
    public Dough createDough();
    public Cheese createCheese();
    public Pepperoni createPepperoni();
}

public class NYPizzaIngredientFactory implements PizzaIngredientFactory {
    public Dough createDough() { return new ThinCrustDough(); }
    public Sauce createCheese() { return new ParmesanCheese(); }
    public Pepperoni createPepperoni() { return new SlicedPepperoni(); }
}

//The Product classes
public abstract class Pizza {
    String name;
    String dough;
    String cheese;
    String pepperoni;
    
    public void setName(String name) { this.name = name; }
    public String getName() { return name; }
    abstract void prepare();
    public void bake() { System.out.println("Baking " + name); }
    
    public String toString() {
        StringBuffer sb = new StringBuffer();
        sb.append(name + ": ");
        if (dough != null) sb.append(dough + " ");
        if (cheese != null) sb.append(cheese + " ");
        if (pepperoni != null) sb.append(pepperoni + " ");
        return sb.toString();
    }
}

public class CheesePizza extends Pizza {
    PizzaIngredientFactory ingredientFactory;
    public CheesePizza(PizzaIngredientFactory ingredientFactory) {
        this.ingredientFactory = ingredientFactory;
    }
    
    void prepare() {
        System.out.println("Preparing " + name);
        dough = ingredientFactory.createDough();
        cheese = ingredientFactory.createCheese();
    }
}

public class PepperoniPizza extends Pizza {
    PizzaIngredientFactory ingredientFactory;
    
    public PepperoniPizza(PizzaIngredientFactory ingredientFactory) {
        this.ingredientFactory = ingredientFactory;
    }
    
    void prepare() {
        System.out.println("Preparing " + name);
        dough = ingredientFactory.createDough();
        cheese = ingredientFactory.createCheese();
        pepperoni = ingredientFactory.createPepperoni();
    }
}

// Client code
public abstract class PizzaStore {
    public Pizza orderPizza(String type) {
        Pizza pizza = createPizza(type);
        pizza.prepare();
        pizza.bake();
        return pizza;
    }

    // A factory method handles object creation and encapsulates it in a subclass
    protected abstract Pizza createPizza(String type);
}

public class NYPizzaStore extends PizzaStore {
    protected Pizza createPizza(String type) {
        Pizza pizza = null;
        PizzaIngredientFactory ingredientFactory = new NYPizzaIngredientFactory();
        
        if (item.equalsIgnoreCase("cheese")) {
            pizza = new CheesePizza(ingredientFactory);
            pizza.setName("New York Style Cheese Pizza");
        } else if (item.equalsIgnoreCase("pepperoni")) {
            pizza = new PepperoniPizza(ingredientFactory);
            pizza.setName("New York Style Pepperoni Pizza");
        }
        return pizza;
    }
}</code></pre>
    </noscript>
</div>
<h4>Factory Method and Abstract Factory compared:</h4>
<p>Factory Method</p>
<ul>
<li>Provides an abstract interface for creating <strong><em>one</em></strong> product.</li>
<li>PizzaStore is implemented as a Factory Method because we want to be able to create a product that varies by region. With the Factory Method, each region gets its own concrete factory that knows how to make pizzas which are appropriate for the area. </li>
</ul>
<p>Abstract Factory</p>
<ul>
<li>Provides an abstract interface for creating a <strong><em>family</em></strong> of products.</li>
<li>PizzaIngredientFactory is implemented as an Abstract Factory because we need to create families of products (the ingredients). Each subclass implements the ingredients using its own regional suppliers. Methods to create products are often implemented with a Factory Method.</li>
</ul>
<h3>Reference</h3>
<ul>
<li><a href="http://howtodoinjava.com/2012/10/22/singleton-design-pattern-in-java/">Singleton design pattern in java</a></li>
<li><a href="http://googletesting.blogspot.com/2008/05/tott-using-dependancy-injection-to.html">Using Dependancy Injection to Avoid Singletons</a></li>
</ul>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname

                    var disqus_identifier = 'creational-patterns-in-java';
                var disqus_url = 'http://www.raydevblog.us/posts/2014/creational-patterns-in-java.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="http://www.linkedin.com/in/leichen1983"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                    <li class="list-group-item"><a href="https://twitter.com/garudareiga"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
                    <li class="list-group-item"><a href="https://github.com/garudareiga"><i class="fa fa-github-square fa-lg"></i> github</a></li>
                    <li class="list-group-item"><a href="http://www.raydevblog.us/feeds/all.atom.xml"><i class="fa fa-rss-square fa-lg"></i> rss</a></li>
                  </ul>
                </li>



                <li class="list-group-item"><a href="http://www.raydevblog.us/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group " id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://www.raydevblog.us/tag/key-value-store.html">
                                key-value store
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://www.raydevblog.us/tag/concurrency.html">
                                concurrency
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://www.raydevblog.us/tag/java.html">
                                java
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://www.raydevblog.us/tag/python.html">
                                python
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/mongodb.html">
                                mongodb
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/data-structure.html">
                                data structure
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/logging.html">
                                logging
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/bloom-filter.html">
                                bloom filter
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/json.html">
                                json
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/consistent-hashing.html">
                                consistent hashing
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/two-phase-commit.html">
                                two-phase commit
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/machine-learning.html">
                                machine learning
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/distributed.html">
                                distributed
                            </a>
                        </li>
                    </ul>
                </li>    
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://jinja.pocoo.org/" target="_blank">
                Jinja2
            </a>
        </li>
        <li class="list-group-item">
            <a href="#" target="_blank">
                You can modify those links in your config file
            </a>
        </li>
      </ul>
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Ray Chen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://www.raydevblog.us/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.raydevblog.us/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.raydevblog.us/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
</body>
</html>