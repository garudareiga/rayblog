<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Java Reentrant Lock - Ray's Thoughts and Writings</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://www.raydevblog.us/posts/2014/java-reentrant-lock.html">

        <meta name="author" content="Ray Chen" />
        <meta name="keywords" content="java,concurrency" />
        <meta name="description" content="Intrinsic Lock Synchronized uses intrinsic locks. Every object in Java has an associated intrinsic lock. Whenever a thread tries to access a synchronized block or method, it acquires the intrinsic lock on that object. The intrinsic locking mechanism have some limitations as follows: It is not possible to attempt to ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://www.raydevblog.us/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://www.raydevblog.us/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="http://www.raydevblog.us/theme/css/style.css" type="text/css"/>

        <link href="http://www.raydevblog.us/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Ray's Thoughts and Writings ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://www.raydevblog.us/" class="navbar-brand">
Ray's Thoughts and Writings            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://www.raydevblog.us/category/algorithm.html">Algorithm</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/data.html">Data</a>
                        </li>
                        <li class="active">
                            <a href="http://www.raydevblog.us/category/java.html">Java</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/python.html">Python</a>
                        </li>
                        <li >
                            <a href="http://www.raydevblog.us/category/system.html">System</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="http://www.raydevblog.us/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://www.raydevblog.us/posts/2014/java-reentrant-lock.html"
                       rel="bookmark"
                       title="Permalink to Java Reentrant Lock">
                        Java Reentrant Lock
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-06-02T20:10:00"> Mon 02 June 2014</time>
    </span>



<span class="label label-default">Tags</span>
	<a href="http://www.raydevblog.us/tag/java.html">java</a>
        /
	<a href="http://www.raydevblog.us/tag/concurrency.html">concurrency</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <h3>Intrinsic Lock</h3>
<p><strong>Synchronized</strong> uses intrinsic locks. Every object in Java has an associated intrinsic lock. Whenever a thread tries to access a synchronized block or method, it acquires the intrinsic lock on that object.</p>
<p>The intrinsic locking mechanism have some limitations as follows:</p>
<ul>
<li>It is not possible to attempt to acquire a lock without being willing to wait for it forever. </li>
<li>It is not possible to interrupt a thread waiting to acquire a lock.</li>
</ul>
<p>As an alternative, ReentrantLock provides more control on lock acquisition. ReentrantLock allows threads to re-request locks they already own. It provides timed or polled lock acquisition. It also has support for configurable fairness policy, allowing more flexible thread scheduling.</p>
<h3>Polled and Timed Lock Acquisition</h3>
<p>Let's see some example code:</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">transferMoney</span><span class="o">(</span><span class="n">Account</span> <span class="n">from</span><span class="o">,</span> <span class="n">Account</span> <span class="n">to</span><span class="o">,</span> <span class="kt">float</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">synchronized</span><span class="o">(</span><span class="n">from</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">synchronized</span><span class="o">(</span><span class="n">to</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">from</span><span class="o">.</span><span class="na">debit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
            <span class="n">to</span><span class="o">.</span><span class="na">credit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>In <em>transferMoney()</em> method above, there is a possibility of <strong>deadlock</strong> when two threads A and B are trying to transfer money at the same time. For example, when thread A has acquired a lock on <em>account_1</em> object and is waiting to acquire a lock on the <em>account_2</em> object, thread B has acquired a lock on the <em>account_2</em> object and is waiting for a lock on <em>account_1</em>. This will lead to deadlock.</p>
<div class="highlight"><pre><span class="n">transferMoney</span><span class="o">(</span><span class="n">account_1</span><span class="o">,</span> <span class="n">account_2</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
<span class="n">transferMoney</span><span class="o">(</span><span class="n">account_2</span><span class="o">,</span> <span class="n">account_1</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
</pre></div>


<p>Using <em>tryLock</em>, a <strong>timed and polled lock acquisition</strong> mechanism lets you regain control if you can not acquire all the required locks, release the ones you have acquired and retry. If we can not acquire both, we will release if one of these has been acquired, then retry. If the locks can not be acquired within the specified time, the transferMoney method will return a failure.</p>
<div class="highlight"><pre><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">transferMoney</span><span class="o">(</span><span class="n">Account</span> <span class="n">from</span><span class="o">,</span> <span class="n">Account</span> <span class="n">to</span><span class="o">,</span> <span class="kt">float</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
    <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">from</span><span class="o">.</span><span class="na">getReentrantLock</span><span class="o">().</span><span class="na">tryLock</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">to</span><span class="o">.</span><span class="na">getReentrantLock</span><span class="o">().</span><span class="na">tryLock</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="n">from</span><span class="o">.</span><span class="na">debit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
                        <span class="n">to</span><span class="o">.</span><span class="na">credit</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
                    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                        <span class="n">to</span><span class="o">.</span><span class="na">getReentrantLock</span><span class="o">().</span><span class="na">unlock</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                <span class="n">from</span><span class="o">.</span><span class="na">getReentrantLock</span><span class="o">().</span><span class="na">unlock</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="o">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>

        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname

                    var disqus_identifier = 'java-reentrant-lock';
                var disqus_url = 'http://www.raydevblog.us/posts/2014/java-reentrant-lock.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="http://www.linkedin.com/in/leichen1983"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                    <li class="list-group-item"><a href="https://twitter.com/garudareiga"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
                    <li class="list-group-item"><a href="https://github.com/garudareiga"><i class="fa fa-github-square fa-lg"></i> github</a></li>
                    <li class="list-group-item"><a href="http://www.raydevblog.us/feeds/all.atom.xml"><i class="fa fa-rss-square fa-lg"></i> rss</a></li>
                  </ul>
                </li>



                <li class="list-group-item"><a href="http://www.raydevblog.us/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                    <ul class="list-group " id="tags">
                        <li class="list-group-item tag-1">
                            <a href="http://www.raydevblog.us/tag/key-value-store.html">
                                key-value store
                            </a>
                        </li>
                        <li class="list-group-item tag-1">
                            <a href="http://www.raydevblog.us/tag/concurrency.html">
                                concurrency
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://www.raydevblog.us/tag/python.html">
                                python
                            </a>
                        </li>
                        <li class="list-group-item tag-2">
                            <a href="http://www.raydevblog.us/tag/java.html">
                                java
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/bloom-filter.html">
                                bloom filter
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/two-phase-commit.html">
                                two-phase commit
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/distributed.html">
                                distributed
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/machine-learning.html">
                                machine learning
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/mongodb.html">
                                mongodb
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/logging.html">
                                logging
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/json.html">
                                json
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/consistent-hashing.html">
                                consistent hashing
                            </a>
                        </li>
                        <li class="list-group-item tag-4">
                            <a href="http://www.raydevblog.us/tag/data-structure.html">
                                data structure
                            </a>
                        </li>
                    </ul>
                </li>    
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://jinja.pocoo.org/" target="_blank">
                Jinja2
            </a>
        </li>
        <li class="list-group-item">
            <a href="#" target="_blank">
                You can modify those links in your config file
            </a>
        </li>
      </ul>
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Ray Chen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://www.raydevblog.us/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://www.raydevblog.us/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://www.raydevblog.us/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'garudareiga'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
</body>
</html>